<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BookMapper">
	
	<resultMap id="BookMap" type="BookVO">
		<result property="bookIsbn" column="BK_ISBN" />
		<result property="bookNm" column="BK_NM" />
		<result property="bookWtr" column="BK_WTR" />
		<result property="publisher" column="BK_PBLSR" />
		<result property="releaseDate" column="BK_RLS" />
		<result property="category" column="CATEGORY" />
		<result property="isBorrowed" column="ISBORROW" />
		<result property="booksub" column="BK_SUB" />
		<result property="registDate" column="BK_REG" />
		<result property="updateDate" column="BK_UDT" />
		<result property="bkCtgC" column="BK_CTG_C" />
		<result property="bkCtgP" column="BK_CTG_P" />
		
		<result property="isSelect" column="isSelect" />
		<result property="query" column="query" />
		<result property="option" column="option" />
	</resultMap>
	


	
	<select id="selectBookList" resultMap="BookMap">
		SELECT 
				  BK_ISBN  
				, BK_NM    
				, BK_WTR   
				, BK_PBLSR 
				, BK_RLS   
				, ISBORROW 
				, BK_REG   
				, BK_UDT   
				, BK_SUB   
				, BK_CTG_C   
				, BK_CTG_P   
		FROM   TBL_BOOK
		ORDER  BY BK_REG DESC 
	</select>
	
	<insert id="insertBook" parameterType="BookVO">
		INSERT INTO TBL_BOOK 
							(
								BK_ISBN         
							  , BK_NM           
							  , BK_WTR          
							  , BK_PBLSR        
							  , BK_RLS          
							  , BK_SUB          
							  , BK_CTG_C        
							  , BK_CTG_P        
							  
							  ) VALUES (
							  				 #{bookIsbn}
							  			   , #{bookNm}
							  			   , #{bookWtr}
							  			   , #{publisher}
							  			   , #{releaseDate}
							  			   , #{category}
							  			   , #{booksub}
							  			)
	</insert>
	
	<update id="updateBook" parameterType="BookVO">
		UPDATE TBL_BOOK 
		SET	   BK_NM    = #{bookNm}     
			 , BK_WTR   = #{bookWtr}    
			 , BK_PBLSR = #{publisher}  
			 , BK_RLS   = #{releaseDate}
			 , BK_SUB   = #{booksub}    
			 , BK_CTG_C = #{category}   
			 , BK_CTG_P = #{category}   
		WHERE  BK_ISBN  = #{bookIsbn}  
	</update>
	
	<delete id="deleteBook" parameterType="String">
		DELETE 
		FROM   TBL_BOOK
		WHERE  BK_ISBN = #{bookIsbn}  
	</delete>
	
	
	<!-- detail -->
	<select id="selectBookOne" parameterType="java.lang.String" resultMap="BookMap">
		SELECT 
			   BK_ISBN
			 , BK_NM            
			 , BK_WTR           
			 , BK_PBLSR         
			 , BK_RLS           
			 , ISBORROW          
			 , BK_REG           
			 , BK_UDT           
			 , BK_SUB           
			 , BK_CTG_C           
			 , BK_CTG_P           
		FROM   TBL_BOOK
		WHERE  BK_ISBN = #{bookIsbn} 
	</select>
	
	<!-- 도서 대출하기. -->
	<update id="updateBookState" parameterType="BookVO"> 
		UPDATE TBL_BOOK 
			<if test="isBorrowed == 1">
			SET	   ISBORROW = (0)
			</if>  
			<if test="isBorrowed == 0">
			SET	   ISBORROW = (1)
			</if>   
		WHERE  BK_ISBN = #{bookIsbn}  
	</update>
	
	<select id="searchBookList" parameterType="BookVO" resultMap="BookMap">
		SELECT 
				  BK_ISBN  
				, BK_NM    
				, BK_WTR   
				, BK_PBLSR 
				, BK_RLS   
				, ISBORROW 
				, BK_REG   
				, BK_UDT   
				, BK_SUB   
				, BK_CTG_C   
				, BK_CTG_P   
		FROM TBL_BOOK
		<where>
		<if test="option == null or option =='all' ">
		AND (
				BK_NM like '%' + #{query} + '%'
		OR		BK_WTR like '%' + #{query} + '%'
		OR		BK_PBLSR like '%' + #{query} + '%'
		) 
		</if> 
		<if test="option != null and option =='bookNm' ">
		AND  BK_NM like '%' + #{query} + '%'
		</if> 
		<if test="option != null and option =='bookWtr' ">
		AND  BK_WTR like '%' + #{query} + '%'
		</if> 
		<if test="option != null and option =='publisher' ">
		AND  BK_PBLSR like '%' + #{query} + '%'
		</if>
		</where> 
	</select>
	
	<select id="selectCategoryBookList" parameterType="BookVO" resultMap="BookMap">
		SELECT 
				  BK_ISBN  
				, BK_NM    
				, BK_WTR   
				, BK_PBLSR 
				, BK_RLS   
				, ISBORROW 
				, BK_REG   
				, BK_UDT   
				, BK_SUB   
				, BK_CTG_C   
				, BK_CTG_P   
		FROM TBL_BOOK
		<where>
		<if test="bkCtgP != null and bkCtgC != null ">
		AND BK_CTG_P = #{bkCtgP}
		AND BK_CTG_C = #{bkCtgC}
		</if>
		<if test="bkCtgP != null and bkCtgC == null ">
		AND BK_CTG_P = #{bkCtgP}
		</if>
		</where> 
	</select>
	
</mapper>