<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BorrowMapper">
	
	<resultMap id="BorrowMap" type="BorrowVO">
		<result property="borrowNo" column="BW_NO" />
		<result property="bookIsbn" column="BK_ISBN" />
		<result property="bookNm" column="BK_NM" />
		<result property="bookWtr" column="BK_WTR" />
		<result property="cCtgIdx" column="BK_CTG_C" />
		<result property="startDate" column="BW_END" />
		<result property="endDate" column="BW_END" />
		<result property="returnDate" column="BW_RETURN" />
		<result property="overdue" column="BW_OVERDUE" />
		
		<result property="isSelect" column="isSelect" />
		<result property="query" column="query" />
		<result property="option" column="option" />
	</resultMap>
	


	
	<select id="selectBorrowList" resultMap="BorrowMap">
		SELECT 
				   BW_NO             
				 , BW.BK_ISBN 
				 , BK.BK_NM
				 , BK.BK_WTR
				 , BK.BK_CTG_C
				 , BW_START          
				 , BW_END            
				 , BW_RETURN         
				 , BW_OVERDUE        	       
		FROM       TBL_BORROW AS BW
		INNER JOIN TBL_BOOK AS BK
		ON 		   BW.BK_ISBN = BK.BK_ISBN
	</select>
	
	<insert id="insertBorrow" parameterType="BorrowVO">
		INSERT INTO TBL_BORROW 
							(
							    BK_ISBN       
							  ) VALUES (
							  			 #{bookIsbn}
							  			)
	</insert>
	
	<!-- 반납라기 -->
	<update id="updateBorrow" parameterType="BorrowVO">
		UPDATE TBL_BORROW 
		SET	   BW_RETURN   = GETDATE()  
			 , BW_OVERDUE  = #{overdue}    
		WHERE  BW_NO       = #{borrowNo}  
	</update>
	
	<delete id="deleteBorrow" parameterType="int">
		DELETE 
		FROM   TBL_BORROW
		WHERE  BW_NO = #{borrowNo}  
	</delete>
	
		<!-- detail -->
	<select id="selectBorrowOne" parameterType="int" resultMap="BorrowMap">
		SELECT 
				   BW_NO             
				 , BW.BK_ISBN 
				 , BK.BK_NM
				 , BK.BK_WTR
				 , BK.BK_CTG_C
				 , BW_START          
				 , BW_END            
				 , BW_RETURN         
				 , BW_OVERDUE        	       
		FROM       TBL_BORROW AS BW
		INNER JOIN TBL_BOOK AS BK
		ON         BW.BK_ISBN = BK.BK_ISBN
		WHERE      BW.BW_NO = #{borrowNo} 
	</select>
	
	
	<select id="searchBorrowList" parameterType="BorrowVO" resultMap="BorrowMap">
		SELECT 
				   BW_NO             
				 , BW.BK_ISBN 
				 , BK.BK_NM
				 , BK.BK_WTR
				 , BK.BK_CTG_C
				 , BW_START          
				 , BW_END            
				 , BW_RETURN         
				 , BW_OVERDUE        	       
		FROM       TBL_BORROW AS BW
		INNER JOIN TBL_BOOK AS BK
		ON 		   BW.BK_ISBN = BK.BK_ISBN
		<where>
		<if test="option == null or option =='all' ">
		AND (
				BK_NM like '%' + #{query} + '%'
		OR		BK_WTR like '%' + #{query} + '%'
		) 
		</if> 
		<if test="option != null and option =='bookNm' ">
		AND BK_NM like '%' + #{query} + '%'
		</if> 
		<if test="option != null and option =='bookWtr' ">
		AND BK_WTR like '%' + #{query} + '%'
		</if> 
		</where>
	</select>
	
	
	
	
	
</mapper>